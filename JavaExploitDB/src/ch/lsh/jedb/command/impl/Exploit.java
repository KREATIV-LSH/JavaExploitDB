package ch.lsh.jedb.command.impl;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.stream.Collectors;

import ch.lsh.jedb.command.Command;
import ch.lsh.jedb.main.CLIManager;

public class Exploit extends Command {

	public Exploit() {
		super("exploit", "acces to all commands for exploits", "try 'exploit help'");
	}

	@Override
	public void execute(String args1) {
		String[] args = args1.split(" ");
		if (args1.length() > 0) {
			performAction(args);
		} else {
			System.err.println("Try 'exploit help' for help!");
		}
	}
	
	private static void performAction(String[] args) {
		String action = args[0].toLowerCase();
		String params = args.length > 1 ? Arrays.toString(Arrays.copyOfRange(args, 1, args.length)).replace("[", "").replace("]", "").replace(",", "") : "";
		
		switch(action) {
			case "help":
				System.out.println("Commands:");
				System.out.println("help");
				System.out.println("list");
				System.out.println("search");
				break;
			case "list":
				System.out.println("Name:\t\tDescription:");
				for(ch.lsh.jedb.exploit.Exploit exp : CLIManager.expManager.getExploits()) {
					System.out.println(exp.getName() + "\t\t" + exp.getDesc());
				}
				break;
			case "search":
				if (params != "" && params != " ") {
					search(params);
				} else {
					System.err.println("Your search for '" + params + "' did not yield any results!");
				}
				break;
			default:
				System.err.println("Command 'exploit " + action + "' not recognized!\nTry 'exploit help' for help");
		}
	}
	
	private static void search(String input) {
		input = input.toLowerCase();
		ArrayList<ch.lsh.jedb.exploit.Exploit> found = new ArrayList<ch.lsh.jedb.exploit.Exploit>();
		for(ch.lsh.jedb.exploit.Exploit exp : CLIManager.expManager.getExploits()) {
			if(exp.getName().toLowerCase().contains(input)) {
				found.add(exp);
			} else if(exp.getDesc().toLowerCase().contains(input)) {
				found.add(exp);
			}
		}
		
		// Remove duplicats if there are any
		List<ch.lsh.jedb.exploit.Exploit> newList = found.stream().distinct().collect(Collectors.toList());
		if(newList.size() > 0) {
			System.out.println("Name:\t\tDescription:");
			for(ch.lsh.jedb.exploit.Exploit exp : newList) {
				System.out.println(exp.getName() + "\t\t" + exp.getDesc());
			}
		} else {
			System.err.println("Your search for '" + input + "' did not yield any results!");
		}
	}

}
